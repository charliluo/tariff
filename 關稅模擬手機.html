<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>半導體關稅衝擊模擬器 (響應式版)</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* --- 整體頁面樣式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 900px;
        }
        header h1 {
            font-size: 2em;
        }
        header p {
            font-size: 0.9em;
            color: #666;
        }

        /* --- 區塊垂直堆疊 --- */
        .dashboard-block {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .dashboard-block h3 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        /* --- 控制區內部網格佈局 (電腦版) --- */
        #control-panel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 30px;
        }
        
        /* --- 分析區塊內部分左右 Flex 佈局 (電腦版) --- */
        .analysis-container {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .analysis-metrics {
            flex: 1;
            min-width: 280px;
        }
        .analysis-chart {
            flex: 1.5;
            min-width: 400px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .control-group span {
            font-size: 0.9em;
            color: #007bff;
            font-weight: bold;
            float: right;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
        }

        .metric { margin-bottom: 25px; }
        .metric-label { font-size: 1em; color: #555; }
        .metric-value { font-size: 2.5em; font-weight: bold; color: #000; }
        .metric-delta { font-size: 1.1em; font-weight: 500; margin-left: 8px; }
        .metric-delta.positive { color: #28a745; }
        .metric-delta.negative { color: #dc3545; }

        #sweet-spot-alert {
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        #sweet-spot-alert.good { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;}
        #sweet-spot-alert.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;}
        #sweet-spot-alert.danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
        
        .chart-container { width:100%; height:250px; }

        /* --- *** 主要修改：響應式設計 (手機版樣式) *** --- */
        /* 當螢幕寬度小於等於 768px 時，套用以下樣式 */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* 手機版邊距縮小 */
            }
            header h1 {
                font-size: 1.5em; /* 手機版標題縮小 */
            }
            .dashboard-block {
                padding: 15px; /* 區塊內部邊距縮小 */
            }
            /* 控制區網格改為單欄 */
            #control-panel-grid {
                grid-template-columns: 1fr;
            }
            /* 分析區改為垂直堆疊 */
            .analysis-container {
                flex-direction: column;
                align-items: stretch;
            }
            .analysis-metrics, .analysis-chart {
                min-width: 100%; /* 寬度佔滿 */
            }
            .metric-value {
                font-size: 2em; /* 數據文字稍小 */
            }
        }

    </style>
</head>
<body>

    <header>
        <h1>半導體關稅衝擊模擬器 📈</h1>
        <p>依序由上往下調整參數，觀察數據與圖表的即時變化，進行策略模擬。</p>
    </header>

    <div class="dashboard-block" id="control-panel">
        <h3>⚙️ 互動參數設定區</h3>
        <div id="control-panel-grid">
            <div class="control-group">
                <label for="asp">1. 產品平均售價 (ASP, 美元)</label>
                <input type="number" id="asp" value="20000" step="1000">
            </div>
            <div class="control-group">
                <label for="initial-margin">2. 台灣廠商原始毛利率<span id="initial-margin-value">55.0%</span></label>
                <input type="range" id="initial-margin" min="30" max="70" value="55" step="0.5">
            </div>
            <div class="control-group">
                <label for="tariff-rate">3. 美國對台關稅稅率<span id="tariff-rate-value">10.0%</span></label>
                <input type="range" id="tariff-rate" min="0" max="50" value="10" step="0.5">
            </div>
            <div class="control-group">
                <label for="pass-through">4. 關稅成本轉嫁比例<span id="pass-through-value">50%</span></label>
                <input type="range" id="pass-through" min="0" max="100" value="50" step="5">
            </div>
        </div>
    </div>

    <div class="dashboard-block" id="impact-analysis">
        <h3>🇹🇼 台灣廠商衝擊分析</h3>
        <div class="analysis-container">
            <div class="analysis-metrics">
                <div class="metric">
                    <div class="metric-label">侵蝕後毛利率</div>
                    <div>
                        <span class="metric-value" id="final-margin"></span>
                        <span class="metric-delta" id="margin-delta"></span>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">對美國客戶的最終報價 (美元)</div>
                    <span class="metric-value" id="final-price"></span>
                </div>
            </div>
            <div class="analysis-chart">
                 <div id="cost-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <div class="dashboard-block" id="competition-analysis">
        <h3>🌍 全球競爭與轉單甜蜜點</h3>
        <div class="analysis-container">
            <div class="analysis-metrics">
                 <div id="sweet-spot-alert"></div>
            </div>
            <div class="analysis-chart">
                <div id="competition-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript 邏輯部分完全無需修改，保持原樣即可 ---
        document.addEventListener('DOMContentLoaded', function () {
            // ... (所有 JavaScript 程式碼都與前一版相同) ...
            const aspInput = document.getElementById('asp');
            const initialMarginSlider = document.getElementById('initial-margin');
            const tariffRateSlider = document.getElementById('tariff-rate');
            const passThroughSlider = document.getElementById('pass-through');
            const initialMarginValue = document.getElementById('initial-margin-value');
            const tariffRateValue = document.getElementById('tariff-rate-value');
            const passThroughValue = document.getElementById('pass-through-value');
            const finalMarginDisplay = document.getElementById('final-margin');
            const marginDeltaDisplay = document.getElementById('margin-delta');
            const finalPriceDisplay = document.getElementById('final-price');
            const sweetSpotAlert = document.getElementById('sweet-spot-alert');
            function updateDashboard() {
                const asp = parseFloat(aspInput.value);
                const initialMarginPct = parseFloat(initialMarginSlider.value);
                const tariffPct = parseFloat(tariffRateSlider.value);
                const passThroughPct = parseFloat(passThroughSlider.value);
                initialMarginValue.textContent = `${initialMarginPct.toFixed(1)}%`;
                tariffRateValue.textContent = `${tariffPct.toFixed(1)}%`;
                passThroughValue.textContent = `${passThroughPct.toFixed(0)}%`;
                const initialMargin = initialMarginPct / 100;
                const tariffRate = tariffPct / 100;
                const passThroughRate = passThroughPct / 100;
                const tariffCost = asp * tariffRate;
                const absorbedCost = tariffCost * (1 - passThroughRate);
                const passedThroughCost = tariffCost * passThroughRate;
                const erodedMarginPctPoint = (absorbedCost / asp) * 100;
                const finalMarginPct = initialMarginPct - erodedMarginPctPoint;
                const finalCustomerPriceTW = asp + passedThroughCost;
                finalMarginDisplay.textContent = `${finalMarginPct.toFixed(2)}%`;
                const deltaMargin = finalMarginPct - initialMarginPct;
                marginDeltaDisplay.textContent = `${deltaMargin.toFixed(2)} 個百分點`;
                marginDeltaDisplay.className = deltaMargin < 0 ? "metric-delta negative" : "metric-delta positive";
                finalPriceDisplay.textContent = `$${finalCustomerPriceTW.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                updateCostChart(asp, initialMargin, absorbedCost);
                updateCompetitionView(finalCustomerPriceTW, asp);
            }
            function updateCostChart(asp, initialMargin, absorbedCost) {
                const originalProfit = asp * initialMargin;
                const originalCost = asp * (1 - initialMargin);
                const newProfit = originalProfit - absorbedCost;
                const categories = ['原始成本', '利潤', '廠商吸收的關稅成本'];
                const trace1 = {x: categories, y: [originalCost, originalProfit, 0], name: '原始', type: 'bar', marker: { color: '#aec7e8' }};
                const trace2 = {x: categories, y: [originalCost, newProfit, absorbedCost], name: '關稅後', type: 'bar', marker: { color: '#1f77b4' }};
                const data = [trace1, trace2];
                const layout = {barmode: 'group', title: { text: '成本與利潤變化比較', font: {size: 16}}, yaxis: { title: '金額 (美元)'}, margin: { l: 60, r: 20, t: 40, b: 40 }, legend: { x: 0.75, y: 1.0, orientation: 'h' }};
                Plotly.react('cost-chart', data, layout, {responsive: true});
            }
            function updateCompetitionView(priceTW, asp) {
                const KOREA_TARIFF_RATE = 0.15;
                const US_ONSHORE_PREMIUM = 0.30;
                const priceKR = asp * (1 + KOREA_TARIFF_RATE);
                const priceUS = asp * (1 + US_ONSHORE_PREMIUM);
                if (priceTW > priceUS) {
                    sweetSpotAlert.className = 'danger';
                    sweetSpotAlert.innerHTML = `<strong>⚠️ 轉單甜蜜點：</strong>成本已高於『美國本土』`;
                } else if (priceTW > priceKR) {
                    sweetSpotAlert.className = 'warning';
                    sweetSpotAlert.innerHTML = `<strong>🟠 注意：</strong>成本已高於『韓國』`;
                } else {
                    sweetSpotAlert.className = 'good';
                    sweetSpotAlert.innerHTML = `<strong>✅ 成本優勢顯著</strong>`;
                }
                const data = [{y: ['台灣', '韓國', '美國本土製造'], x: [priceTW, priceKR, priceUS], text: [priceTW, priceKR, priceUS].map(val => `$${val.toLocaleString('en-US', {maximumFractionDigits:0})}`), textposition: 'inside', insidetextanchor: 'middle', type: 'bar', orientation: 'h', marker: { color: ['#1f77b4', '#ff7f0e', '#d62728'] }}];
                const layout = {title: { text: '不同地點的採購總成本比較', font: {size: 16}}, xaxis: { title: '客戶最終成本 (美元)' }, margin: { l: 100, r: 20, t: 40, b: 40 }, yaxis: { automargin: true }};
                Plotly.react('competition-chart', data, layout, {responsive: true});
            }
            const controls = [aspInput, initialMarginSlider, tariffRateSlider, passThroughSlider];
            controls.forEach(control => { control.addEventListener('input', updateDashboard); });
            updateDashboard();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠå°é«”é—œç¨…è¡æ“Šæ¨¡æ“¬å™¨ (éŸ¿æ‡‰å¼ç‰ˆ)</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* --- æ•´é«”é é¢æ¨£å¼ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 900px;
        }
        header h1 {
            font-size: 2em;
        }
        header p {
            font-size: 0.9em;
            color: #666;
        }

        /* --- å€å¡Šå‚ç›´å †ç–Š --- */
        .dashboard-block {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .dashboard-block h3 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        /* --- æ§åˆ¶å€å…§éƒ¨ç¶²æ ¼ä½ˆå±€ (é›»è…¦ç‰ˆ) --- */
        #control-panel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 30px;
        }
        
        /* --- åˆ†æå€å¡Šå…§éƒ¨åˆ†å·¦å³ Flex ä½ˆå±€ (é›»è…¦ç‰ˆ) --- */
        .analysis-container {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .analysis-metrics {
            flex: 1;
            min-width: 280px;
        }
        .analysis-chart {
            flex: 1.5;
            min-width: 400px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .control-group span {
            font-size: 0.9em;
            color: #007bff;
            font-weight: bold;
            float: right;
        }
        input[type="number"], input[type="range"] {
            width: 100%;
        }

        .metric { margin-bottom: 25px; }
        .metric-label { font-size: 1em; color: #555; }
        .metric-value { font-size: 2.5em; font-weight: bold; color: #000; }
        .metric-delta { font-size: 1.1em; font-weight: 500; margin-left: 8px; }
        .metric-delta.positive { color: #28a745; }
        .metric-delta.negative { color: #dc3545; }

        #sweet-spot-alert {
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }
        #sweet-spot-alert.good { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;}
        #sweet-spot-alert.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba;}
        #sweet-spot-alert.danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
        
        .chart-container { width:100%; height:250px; }

        /* --- *** ä¸»è¦ä¿®æ”¹ï¼šéŸ¿æ‡‰å¼è¨­è¨ˆ (æ‰‹æ©Ÿç‰ˆæ¨£å¼) *** --- */
        /* ç•¶è¢å¹•å¯¬åº¦å°æ–¼ç­‰æ–¼ 768px æ™‚ï¼Œå¥—ç”¨ä»¥ä¸‹æ¨£å¼ */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* æ‰‹æ©Ÿç‰ˆé‚Šè·ç¸®å° */
            }
            header h1 {
                font-size: 1.5em; /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œç¸®å° */
            }
            .dashboard-block {
                padding: 15px; /* å€å¡Šå…§éƒ¨é‚Šè·ç¸®å° */
            }
            /* æ§åˆ¶å€ç¶²æ ¼æ”¹ç‚ºå–®æ¬„ */
            #control-panel-grid {
                grid-template-columns: 1fr;
            }
            /* åˆ†æå€æ”¹ç‚ºå‚ç›´å †ç–Š */
            .analysis-container {
                flex-direction: column;
                align-items: stretch;
            }
            .analysis-metrics, .analysis-chart {
                min-width: 100%; /* å¯¬åº¦ä½”æ»¿ */
            }
            .metric-value {
                font-size: 2em; /* æ•¸æ“šæ–‡å­—ç¨å° */
            }
        }

    </style>
</head>
<body>

    <header>
        <h1>åŠå°é«”é—œç¨…è¡æ“Šæ¨¡æ“¬å™¨ ğŸ“ˆ</h1>
        <p>ä¾åºç”±ä¸Šå¾€ä¸‹èª¿æ•´åƒæ•¸ï¼Œè§€å¯Ÿæ•¸æ“šèˆ‡åœ–è¡¨çš„å³æ™‚è®ŠåŒ–ï¼Œé€²è¡Œç­–ç•¥æ¨¡æ“¬ã€‚</p>
    </header>

    <div class="dashboard-block" id="control-panel">
        <h3>âš™ï¸ äº’å‹•åƒæ•¸è¨­å®šå€</h3>
        <div id="control-panel-grid">
            <div class="control-group">
                <label for="asp">1. ç”¢å“å¹³å‡å”®åƒ¹ (ASP, ç¾å…ƒ)</label>
                <input type="number" id="asp" value="20000" step="1000">
            </div>
            <div class="control-group">
                <label for="initial-margin">2. å°ç£å» å•†åŸå§‹æ¯›åˆ©ç‡<span id="initial-margin-value">55.0%</span></label>
                <input type="range" id="initial-margin" min="30" max="70" value="55" step="0.5">
            </div>
            <div class="control-group">
                <label for="tariff-rate">3. ç¾åœ‹å°å°é—œç¨…ç¨…ç‡<span id="tariff-rate-value">10.0%</span></label>
                <input type="range" id="tariff-rate" min="0" max="50" value="10" step="0.5">
            </div>
            <div class="control-group">
                <label for="pass-through">4. é—œç¨…æˆæœ¬è½‰å«æ¯”ä¾‹<span id="pass-through-value">50%</span></label>
                <input type="range" id="pass-through" min="0" max="100" value="50" step="5">
            </div>
        </div>
    </div>

    <div class="dashboard-block" id="impact-analysis">
        <h3>ğŸ‡¹ğŸ‡¼ å°ç£å» å•†è¡æ“Šåˆ†æ</h3>
        <div class="analysis-container">
            <div class="analysis-metrics">
                <div class="metric">
                    <div class="metric-label">ä¾µè•å¾Œæ¯›åˆ©ç‡</div>
                    <div>
                        <span class="metric-value" id="final-margin"></span>
                        <span class="metric-delta" id="margin-delta"></span>
                    </div>
                </div>
                <div class="metric">
                    <div class="metric-label">å°ç¾åœ‹å®¢æˆ¶çš„æœ€çµ‚å ±åƒ¹ (ç¾å…ƒ)</div>
                    <span class="metric-value" id="final-price"></span>
                </div>
            </div>
            <div class="analysis-chart">
                 <div id="cost-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <div class="dashboard-block" id="competition-analysis">
        <h3>ğŸŒ å…¨çƒç«¶çˆ­èˆ‡è½‰å–®ç”œèœœé»</h3>
        <div class="analysis-container">
            <div class="analysis-metrics">
                 <div id="sweet-spot-alert"></div>
            </div>
            <div class="analysis-chart">
                <div id="competition-chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript é‚è¼¯éƒ¨åˆ†å®Œå…¨ç„¡éœ€ä¿®æ”¹ï¼Œä¿æŒåŸæ¨£å³å¯ ---
        document.addEventListener('DOMContentLoaded', function () {
            // ... (æ‰€æœ‰ JavaScript ç¨‹å¼ç¢¼éƒ½èˆ‡å‰ä¸€ç‰ˆç›¸åŒ) ...
            const aspInput = document.getElementById('asp');
            const initialMarginSlider = document.getElementById('initial-margin');
            const tariffRateSlider = document.getElementById('tariff-rate');
            const passThroughSlider = document.getElementById('pass-through');
            const initialMarginValue = document.getElementById('initial-margin-value');
            const tariffRateValue = document.getElementById('tariff-rate-value');
            const passThroughValue = document.getElementById('pass-through-value');
            const finalMarginDisplay = document.getElementById('final-margin');
            const marginDeltaDisplay = document.getElementById('margin-delta');
            const finalPriceDisplay = document.getElementById('final-price');
            const sweetSpotAlert = document.getElementById('sweet-spot-alert');
            function updateDashboard() {
                const asp = parseFloat(aspInput.value);
                const initialMarginPct = parseFloat(initialMarginSlider.value);
                const tariffPct = parseFloat(tariffRateSlider.value);
                const passThroughPct = parseFloat(passThroughSlider.value);
                initialMarginValue.textContent = `${initialMarginPct.toFixed(1)}%`;
                tariffRateValue.textContent = `${tariffPct.toFixed(1)}%`;
                passThroughValue.textContent = `${passThroughPct.toFixed(0)}%`;
                const initialMargin = initialMarginPct / 100;
                const tariffRate = tariffPct / 100;
                const passThroughRate = passThroughPct / 100;
                const tariffCost = asp * tariffRate;
                const absorbedCost = tariffCost * (1 - passThroughRate);
                const passedThroughCost = tariffCost * passThroughRate;
                const erodedMarginPctPoint = (absorbedCost / asp) * 100;
                const finalMarginPct = initialMarginPct - erodedMarginPctPoint;
                const finalCustomerPriceTW = asp + passedThroughCost;
                finalMarginDisplay.textContent = `${finalMarginPct.toFixed(2)}%`;
                const deltaMargin = finalMarginPct - initialMarginPct;
                marginDeltaDisplay.textContent = `${deltaMargin.toFixed(2)} å€‹ç™¾åˆ†é»`;
                marginDeltaDisplay.className = deltaMargin < 0 ? "metric-delta negative" : "metric-delta positive";
                finalPriceDisplay.textContent = `$${finalCustomerPriceTW.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                updateCostChart(asp, initialMargin, absorbedCost);
                updateCompetitionView(finalCustomerPriceTW, asp);
            }
            function updateCostChart(asp, initialMargin, absorbedCost) {
                const originalProfit = asp * initialMargin;
                const originalCost = asp * (1 - initialMargin);
                const newProfit = originalProfit - absorbedCost;
                const categories = ['åŸå§‹æˆæœ¬', 'åˆ©æ½¤', 'å» å•†å¸æ”¶çš„é—œç¨…æˆæœ¬'];
                const trace1 = {x: categories, y: [originalCost, originalProfit, 0], name: 'åŸå§‹', type: 'bar', marker: { color: '#aec7e8' }};
                const trace2 = {x: categories, y: [originalCost, newProfit, absorbedCost], name: 'é—œç¨…å¾Œ', type: 'bar', marker: { color: '#1f77b4' }};
                const data = [trace1, trace2];
                const layout = {barmode: 'group', title: { text: 'æˆæœ¬èˆ‡åˆ©æ½¤è®ŠåŒ–æ¯”è¼ƒ', font: {size: 16}}, yaxis: { title: 'é‡‘é¡ (ç¾å…ƒ)'}, margin: { l: 60, r: 20, t: 40, b: 40 }, legend: { x: 0.75, y: 1.0, orientation: 'h' }};
                Plotly.react('cost-chart', data, layout, {responsive: true});
            }
            function updateCompetitionView(priceTW, asp) {
                const KOREA_TARIFF_RATE = 0.15;
                const US_ONSHORE_PREMIUM = 0.30;
                const priceKR = asp * (1 + KOREA_TARIFF_RATE);
                const priceUS = asp * (1 + US_ONSHORE_PREMIUM);
                if (priceTW > priceUS) {
                    sweetSpotAlert.className = 'danger';
                    sweetSpotAlert.innerHTML = `<strong>âš ï¸ è½‰å–®ç”œèœœé»ï¼š</strong>æˆæœ¬å·²é«˜æ–¼ã€ç¾åœ‹æœ¬åœŸã€`;
                } else if (priceTW > priceKR) {
                    sweetSpotAlert.className = 'warning';
                    sweetSpotAlert.innerHTML = `<strong>ğŸŸ  æ³¨æ„ï¼š</strong>æˆæœ¬å·²é«˜æ–¼ã€éŸ“åœ‹ã€`;
                } else {
                    sweetSpotAlert.className = 'good';
                    sweetSpotAlert.innerHTML = `<strong>âœ… æˆæœ¬å„ªå‹¢é¡¯è‘—</strong>`;
                }
                const data = [{y: ['å°ç£', 'éŸ“åœ‹', 'ç¾åœ‹æœ¬åœŸè£½é€ '], x: [priceTW, priceKR, priceUS], text: [priceTW, priceKR, priceUS].map(val => `$${val.toLocaleString('en-US', {maximumFractionDigits:0})}`), textposition: 'inside', insidetextanchor: 'middle', type: 'bar', orientation: 'h', marker: { color: ['#1f77b4', '#ff7f0e', '#d62728'] }}];
                const layout = {title: { text: 'ä¸åŒåœ°é»çš„æ¡è³¼ç¸½æˆæœ¬æ¯”è¼ƒ', font: {size: 16}}, xaxis: { title: 'å®¢æˆ¶æœ€çµ‚æˆæœ¬ (ç¾å…ƒ)' }, margin: { l: 100, r: 20, t: 40, b: 40 }, yaxis: { automargin: true }};
                Plotly.react('competition-chart', data, layout, {responsive: true});
            }
            const controls = [aspInput, initialMarginSlider, tariffRateSlider, passThroughSlider];
            controls.forEach(control => { control.addEventListener('input', updateDashboard); });
            updateDashboard();
        });
    </script>
</body>
</html>